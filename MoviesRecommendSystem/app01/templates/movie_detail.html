{% extends "layout.html" %}
{% load static %}
{% block CSS %}
    <style>
        .poster {
            float: left;
            margin: 3px 12px 0 0;
            overflow: hidden;
            text-align: center;
        }

        .info {
            max-width: 800px;
            margin-top: 15px;
            float: left;
            word-wrap: break-word;
        }

        .smovie {
            display: block;
            float: left;
            font-size: 15px;
            text-align: center;
            margin: 0 25px 10px 0;
            width: 200px;
        }

        hr {
            -moz-border-bottom-colors: none;
            -moz-border-image: none;
            -moz-border-left-colors: none;
            -moz-border-right-colors: none;
            -moz-border-top-colors: none;
            border-color: #c9302c;
            border-style: solid none;
            border-width: 1px 0;
            margin: 18px 0;
        }
    </style>
    <link href="{% static 'css/star-rating.css' %}" media="all" rel="stylesheet" type="text/css"/>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="poster">
            <a href="#">
                <div class="poster_div">
                    <img src="/static/IMDBInfo/poster/{{ movie.imdb_id }}.jpg" alt="电影封面">
                </div>
            </a>
        </div>
        <div class="info">
            <p>
                电影名：
                {{ movie.name }}&nbsp;&nbsp;&nbsp;&nbsp;
                <span>
                    {% for foo in movie.get_score_int_range %}
                        <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
                    {% endfor %}
                </span>
                <strong style="color:#e09015">{{ movie.get_score }}</strong>
            </p>
            <p>简介：{{ movie.intro }}</p>
            <p>导演：{{ movie.director }}</p>
            <p>编剧：{{ movie.writers }}</p>
            <p>主演：{{ movie.actors }}</p>
            <p>
                类型：{{ movie.get_genre }}
            </p>
            <p>时长：{{ movie.duration }}</p>
            <p>发行时间：{{ movie.release_time }}</p>
        </div>
    </div>

    <div class="container similarity_movies" style="margin-top: 30px">
        {# 利用js动态生成，依赖这个form #}
        <form id="formRating" class="star" method="post">
            {# 评分组件 #}
            <input id="input-2ba" name="score" value="{{ rating_info.score }}" type="number" class="rating" min="0"
                   max="5" step="0.5" data-stars=5 data-symbol="&#xe005;" data-default-caption="{rating} 星"
                   data-star-captions="{}" data-show-clear="true" data-clear-caption="未评分">
            <label for="comment">评论:</label>
            <textarea class="form-control" name="comment" rows="5" id="comment"
                      placeholder={{ rating_info.comment }}></textarea>
            <br>
            <div class="form-group">
                <button id="btnSubmit" type="button" class="btn btn-primary" style="margin-right: 10px">提交</button>
                <button type="reset" class="btn btn-default">清空评论</button>
            </div>
        </form>
    </div>

    <div class="container" style="margin-top: 25px">
        <div class="alert alert-warning" role="alert">喜欢这部电影的人也喜欢：</div>
        <div>
            {% for movie in similar_movies %}
                <div class="smovie" {% if forloop.first %} style="margin-left: -6px" {% endif %}>
                    <a href="/movie/detail/{{ movie.id }}" class="item">
                        <div class="poster_div">
                            <img src="/static/IMDBInfo/poster/{{ movie.imdb_id }}.jpg" alt="电影封面"
                                 style="width: 80%; height: 80%;">
                            <p>{{ movie.name }}
                                <strong style="color:#e09015">{{ movie.get_score }}</strong>
                            </p>
                        </div>
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>
    <div class="container">
        <span style="font-size: 20px; font-weight: 500">评论</span>
        &nbsp;
        <span style="font-size: 13px; font-weight: 400">{{ comments|length }}</span>
        <div class="panel-body">
            <ul class="media-list">
                {% if comments %}
                    {% for com in comments %}
                        <li class="media">
                            <div class="media-left">
                                <a href="#">
                                    <img class="media-object" src="https://via.placeholder.com/64x64" alt="...">
                                </a>
                            </div>
                            <div class="media-body">
                                <h4 class="media-heading">{{ com.username }} {{ com.time }}</h4>
                                {{ com.comment }}
                            </div>
                        </li>
                        <hr>
                    {% endfor %}
                    </ul>
                {% else %}
                    <div class="text-center">
                        <span style="color: #7c7c7c">没有更多评论</span>
                    </div>
                {% endif %}
        </div>
    </div>



{% endblock %}

{% block JS %}
    <script src="{% static 'js/star-rating.js' %}" type="text/javascript"></script>
    <script type="text/javascript">
        let status = {{ movie.get_score }};

        jQuery(document).ready(function () {
            $(".rating-kv").rating();
        });

        $(function () {
            bindBtnSubmit();
        })

        function bindBtnSubmit() {
            $("#btnSubmit").click(function () {
                $.ajax({
                    url: "/movie/rating/?movie_id=" + {{ movie.id }},
                    type: "post",
                    data: $("#formRating").serialize(),
                    dataType: "JSON",
                    success: function (res) {
                        if (res.status) {
                            alert("提交成功");
                            location.reload();
                        } else {
                            alert(res.msg);
                        }
                    }

                })
            })
        }

    </script>
{% endblock %}